import { MaterialIcons } from '@expo/vector-icons';
import AsyncStorage from '@react-native-async-storage/async-storage';
import Voice from '@react-native-voice/voice';
import * as Speech from 'expo-speech';
import React, { useEffect, useState } from 'react';
import {
  ActivityIndicator,
  Alert,
  Animated,
  Dimensions,
  FlatList,
  Linking,
  Modal, PermissionsAndroid, Platform, RefreshControl,
  ScrollView,
  Share,
  StyleSheet,
  Text,
  TextInput,
  TouchableOpacity,
  View
} from 'react-native';

type Conseil = {
  id: string;
  category: 'nutrition' | 'activite' | 'education' | 'prevention';
  disease: Disease;
  title: string;
  description: string;
  points: number;
  isFavorite?: boolean;
  dateAdded?: string;
  tips?: string[];
  relatedLinks?: string[];
};

type Quiz = {
  id: string;
  question: string;
  options: string[];
  correctAnswer: string;
  disease: Disease;
  explanation: string;
  points: number;
  timeLimit?: number;
};

type Disease = 
  | 'diabete'
  | 'hypertension'
  | 'insuffisance-cardiaque'
  | 'atherosclerose'
  | 'maladie-coronarienne'
  | 'asthme'
  | 'bpco'
  | 'fibrose-pulmonaire'
  | 'hypothyroidie'
  | 'hyperthyroidie'
  | 'obesite'
  | 'insuffisance-renale'
  | 'nephropathie-diabetique'
  | 'parkinson'
  | 'sclerose-en-plaques'
  | 'epilepsie'
  | 'migraine-chronique'
  | 'lupus'
  | 'polyarthrite-rhumatoide'
  | 'crohn'
  | 'colite-ulcereuse'
  | 'cancer-sein'
  | 'cancer-prostate'
  | 'cancer-poumon'
  | 'leucemie'
  | 'arthrose'
  | 'osteoporose'
  | 'fibromyalgie'
  | 'depression'
  | 'troubles-anxieux'
  | 'schizophrenie'
  | 'trouble-bipolaire'
  | 'cirrhose'
  | 'psoriasis'
  | 'endometriose'
  | 'vih'
  | 'general';

type Badge = {
  id: string;
  name: string;
  description: string;
  icon: string;
  color: string;
  unlocked: boolean;
  requiredPoints: number;
  dateUnlocked?: string;
  category?: string;
};

type UserProgress = {
  streak: number;
  lastVisit: string;
  completedToday: number;
  weeklyGoal: number;
  monthlyStats: { [key: string]: number };
};

type Challenge = {
  id: string;
  title: string;
  description: string;
  target: number;
  current: number;
  reward: number;
  deadline: string;
  type: 'daily' | 'weekly' | 'monthly';
};

const speak = (text: string, language: string = 'fr-FR') => {
  Speech.speak(text, { language, pitch: 1.0, rate: 0.9 });
};

const { width } = Dimensions.get('window');

export default function ConseilsSante() {
  const [activeTab, setActiveTab] = useState<'conseils' | 'quiz' | 'badges' | 'progress' | 'challenges'>('conseils');
  const [userPoints, setUserPoints] = useState(0);
  const [completedQuizzes, setCompletedQuizzes] = useState<string[]>([]);
  const [favoriteConseils, setFavoriteConseils] = useState<string[]>([]);
  const [searchQuery, setSearchQuery] = useState('');
  const [selectedFilter, setSelectedFilter] = useState<Disease | 'all'>('all');
  const [fadeAnim] = useState(new Animated.Value(1));
  const [tabAnim] = useState(new Animated.Value(0));
  const [showDetailsModal, setShowDetailsModal] = useState(false);
  const [selectedConseil, setSelectedConseil] = useState<Conseil | null>(null);
  const [refreshing, setRefreshing] = useState(false);
  const [loading, setLoading] = useState(false);
  const [pageConseils, setPageConseils] = useState(1);
  const [pageQuizzes, setPageQuizzes] = useState(1);
  const [isRecording, setIsRecording] = useState(false);
  const [recognizedText, setRecognizedText] = useState('');
  const [selectedQuiz, setSelectedQuiz] = useState<Quiz | null>(null);
  const itemsPerPage = 10;

  const [userProgress, setUserProgress] = useState<UserProgress>({
    streak: 0,
    lastVisit: new Date().toDateString(),
    completedToday: 0,
    weeklyGoal: 5,
    monthlyStats: {},
  });

  const [challenges, setChallenges] = useState<Challenge[]>([
    {
      id: 'daily1',
      title: 'üéØ Quiz Quotidien',
      description: 'Compl√©tez 3 quiz aujourd\'hui',
      target: 3,
      current: 0,
      reward: 25,
      deadline: new Date().toDateString(),
      type: 'daily',
    },
    {
      id: 'weekly1',
      title: 'üìö Explorateur Sant√©',
      description: 'Lisez 10 conseils cette semaine',
      target: 10,
      current: 0,
      reward: 50,
      deadline: getWeekEnd(),
      type: 'weekly',
    },
    {
      id: 'monthly1',
      title: 'üèÜ Ma√Ætre de la Sant√©',
      description: 'Gagnez 200 points ce mois-ci',
      target: 200,
      current: 0,
      reward: 100,
      deadline: getMonthEnd(),
      type: 'monthly',
    },
  ]);

  const [conseils, setConseils] = useState<Conseil[]>([]);
  const [quizzes, setQuizzes] = useState<Quiz[]>([]);

  const [badges, setBadges] = useState<Badge[]>([
    {
      id: 'debutant',
      name: 'üå± D√©butant Sant√©',
      description: 'Premiers pas vers une meilleure sant√©',
      icon: 'eco',
      color: '#4CAF50',
      unlocked: false,
      requiredPoints: 25,
      category: 'progression',
    },
    {
      id: 'nutritionniste',
      name: 'ü•ó Expert Nutrition',
      description: 'Ma√Ætrise des conseils nutritionnels',
      icon: 'restaurant',
      color: '#FF9800',
      unlocked: false,
      requiredPoints: 50,
      category: 'expertise',
    },
    {
      id: 'sportif',
      name: 'üèÉ‚Äç‚ôÇÔ∏è Actif au Quotidien',
      description: 'Champion de l\'activit√© physique',
      icon: 'directions-run',
      color: '#2196F3',
      unlocked: false,
      requiredPoints: 75,
      category: 'activite',
    },
    {
      id: 'savant',
      name: 'üéì Sage de la Sant√©',
      description: 'Connaissance approfondie des maladies',
      icon: 'school',
      color: '#9C27B0',
      unlocked: false,
      requiredPoints: 100,
      category: 'expertise',
    },
    {
      id: 'champion',
      name: 'üèÜ Champion Yafa',
      description: 'Ma√Ætre de la sant√© communautaire',
      icon: 'emoji-events',
      color: '#FFD700',
      unlocked: false,
      requiredPoints: 150,
      category: 'elite',
    },
    {
      id: 'assidu',
      name: 'üìÖ Visiteur Assidu',
      description: 'Connect√© 7 jours cons√©cutifs',
      icon: 'event',
      color: '#FF5722',
      unlocked: false,
      requiredPoints: 0,
      category: 'regularite',
    },
    {
      id: 'quizmaster',
      name: 'üß† Ma√Ætre Quiz',
      description: '10 quiz r√©ussis',
      icon: 'psychology',
      color: '#E91E63',
      unlocked: false,
      requiredPoints: 0,
      category: 'performance',
    },
    {
      id: 'partageur',
      name: 'üì¢ Ambassadeur Sant√©',
      description: 'Partag√© 5 conseils avec des amis',
      icon: 'share',
      color: '#00BCD4',
      unlocked: false,
      requiredPoints: 0,
      category: 'social',
    },
  ]);

  const fetchConseils = async (page: number): Promise<Conseil[]> => {
    setLoading(true);
    try {
      await new Promise(resolve => setTimeout(resolve, 1000));
      
      const conseilPool: Conseil[] = [
        // Diab√®te
        {
          id: `conseil-${Date.now()}-${page}-1`,
          category: 'nutrition',
          disease: 'diabete',
          title: 'ü•ë Avocats pour le diab√®te',
          description: 'Les avocats sont riches en graisses saines et aident √† stabiliser la glyc√©mie.',
          points: 10,
          tips: ['Consommez un demi-avocat par jour', 'Ajoutez-le √† vos salades', '√âvitez les sauces sucr√©es'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.sante.fr/nutrition'],
        },
        {
          id: `conseil-${Date.now()}-${page}-2`,
          category: 'activite',
          disease: 'diabete',
          title: 'üö∂ Marche r√©guli√®re pour le diab√®te',
          description: 'La marche aide √† am√©liorer la sensibilit√© √† l‚Äôinsuline et √† contr√¥ler la glyc√©mie.',
          points: 10,
          tips: ['Marchez 30 minutes par jour', 'Portez des chaussures confortables', 'Surveillez votre glyc√©mie apr√®s l‚Äôeffort'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.who.int/fr'],
        },
        // Hypertension
        {
          id: `conseil-${Date.now()}-${page}-3`,
          category: 'activite',
          disease: 'hypertension',
          title: 'üö¥‚Äç‚ôÄÔ∏è V√©lo pour la tension',
          description: 'Le v√©lo r√©gulier r√©duit la pression art√©rielle et am√©liore la sant√© cardiaque.',
          points: 15,
          tips: ['Faites 30 minutes 3 fois par semaine', 'Choisissez un terrain plat', 'Portez un casque'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.who.int/fr'],
        },
        {
          id: `conseil-${Date.now()}-${page}-4`,
          category: 'nutrition',
          disease: 'hypertension',
          title: 'ü•ó R√©duire le sel pour la tension',
          description: 'Une faible consommation de sel aide √† maintenir une pression art√©rielle saine.',
          points: 10,
          tips: ['√âvitez les aliments transform√©s', 'Utilisez des herbes pour assaisonner', 'Lisez les √©tiquettes alimentaires'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.santepubliquefrance.fr'],
        },
        // Insuffisance cardiaque
        {
          id: `conseil-${Date.now()}-${page}-5`,
          category: 'prevention',
          disease: 'insuffisance-cardiaque',
          title: 'ü©∫ Suivi m√©dical r√©gulier',
          description: 'Un suivi r√©gulier avec un cardiologue aide √† g√©rer l‚Äôinsuffisance cardiaque.',
          points: 10,
          tips: ['Prenez vos m√©dicaments comme prescrit', 'Surveillez votre poids quotidiennement', 'Signalez tout sympt√¥me nouveau'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.who.int/fr'],
        },
        {
          id: `conseil-${Date.now()}-${page}-6`,
          category: 'nutrition',
          disease: 'insuffisance-cardiaque',
          title: 'üçé Alimentation pauvre en sodium',
          description: 'R√©duire le sodium aide √† √©viter la r√©tention d‚Äôeau dans l‚Äôinsuffisance cardiaque.',
          points: 10,
          tips: ['Pr√©f√©rez les aliments frais', '√âvitez les conserves', 'Consultez un di√©t√©ticien'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.sante.fr/nutrition'],
        },
        // Ath√©roscl√©rose
        {
          id: `conseil-${Date.now()}-${page}-7`,
          category: 'nutrition',
          disease: 'atherosclerose',
          title: 'ü•ú Consommer des graisses saines',
          description: 'Les graisses insatur√©es, comme celles des noix, r√©duisent le risque d‚Äôath√©roscl√©rose.',
          points: 10,
          tips: ['Consommez des noix non sal√©es', 'Ajoutez de l‚Äôhuile d‚Äôolive √† vos plats', 'Limitez les graisses satur√©es'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.santepubliquefrance.fr'],
        },
        {
          id: `conseil-${Date.now()}-${page}-8`,
          category: 'activite',
          disease: 'atherosclerose',
          title: 'üèÉ‚Äç‚ôÇÔ∏è Exercice a√©robique mod√©r√©',
          description: 'L‚Äôexercice a√©robique am√©liore la circulation et r√©duit l‚Äôaccumulation de plaque.',
          points: 15,
          tips: ['Marchez ou nagez 30 minutes par jour', '√âvitez les efforts intenses', 'Consultez votre m√©decin avant de commencer'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.who.int/fr'],
        },
        // Maladie coronarienne
        {
          id: `conseil-${Date.now()}-${page}-9`,
          category: 'prevention',
          disease: 'maladie-coronarienne',
          title: 'üö≠ Arr√™ter de fumer',
          description: 'Cesser de fumer r√©duit le risque de complications coronariennes.',
          points: 15,
          tips: ['Consultez un sp√©cialiste pour arr√™ter', 'Utilisez des substituts nicotiniques', 'Rejoignez un groupe de soutien'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.who.int/fr'],
        },
        {
          id: `conseil-${Date.now()}-${page}-10`,
          category: 'nutrition',
          disease: 'maladie-coronarienne',
          title: 'üêü Poissons riches en om√©ga-3',
          description: 'Les om√©ga-3 prot√®gent le c≈ìur et r√©duisent l‚Äôinflammation.',
          points: 10,
          tips: ['Mangez du saumon ou du maquereau 2 fois par semaine', '√âvitez les fritures', 'Pr√©f√©rez la cuisson au four'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.sante.fr/nutrition'],
        },
        // Asthme
        {
          id: `conseil-${Date.now()}-${page}-11`,
          category: 'prevention',
          disease: 'asthme',
          title: 'üå¨Ô∏è √âviter les d√©clencheurs de l‚Äôasthme',
          description: 'R√©duisez l‚Äôexposition aux allerg√®nes comme la poussi√®re et le pollen pour mieux g√©rer l‚Äôasthme.',
          points: 10,
          tips: ['Utilisez des filtres √† air', '√âvitez de fumer', 'Portez un masque en ext√©rieur'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.santepubliquefrance.fr'],
        },
        {
          id: `conseil-${Date.now()}-${page}-12`,
          category: 'activite',
          disease: 'asthme',
          title: 'üèä Natation pour l‚Äôasthme',
          description: 'La natation dans un environnement humide aide √† renforcer les poumons sans d√©clencher de crises.',
          points: 10,
          tips: ['Nagez dans une piscine chauff√©e', '√âvitez les efforts intenses', 'Utilisez votre inhalateur avant l‚Äôexercice'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.who.int/fr'],
        },
        // BPCO
        {
          id: `conseil-${Date.now()}-${page}-13`,
          category: 'prevention',
          disease: 'bpco',
          title: 'üö≠ Cesser le tabagisme pour la BPCO',
          description: 'Arr√™ter de fumer ralentit la progression de la BPCO.',
          points: 15,
          tips: ['Consultez un pneumologue', 'Utilisez des patchs nicotiniques', '√âvitez les environnements enfum√©s'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.santepubliquefrance.fr'],
        },
        {
          id: `conseil-${Date.now()}-${page}-14`,
          category: 'activite',
          disease: 'bpco',
          title: 'üßò Exercices de respiration',
          description: 'Les exercices de respiration am√©liorent la capacit√© pulmonaire dans la BPCO.',
          points: 10,
          tips: ['Pratiquez la respiration diaphragmatique', 'Consultez un kin√©sith√©rapeute', 'Faites des exercices doux quotidiens'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.who.int/fr'],
        },
        // Fibrose pulmonaire
        {
          id: `conseil-${Date.now()}-${page}-15`,
          category: 'prevention',
          disease: 'fibrose-pulmonaire',
          title: 'ü©∫ Suivi pulmonaire r√©gulier',
          description: 'Un suivi m√©dical r√©gulier aide √† surveiller la progression de la fibrose pulmonaire.',
          points: 10,
          tips: ['Planifiez des consultations trimestrielles', 'Surveillez les sympt√¥mes respiratoires', '√âvitez les infections pulmonaires'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.sante.fr'],
        },
        {
          id: `conseil-${Date.now()}-${page}-16`,
          category: 'activite',
          disease: 'fibrose-pulmonaire',
          title: 'üö∂ Marche douce pour la fibrose',
          description: 'Une marche l√©g√®re am√©liore l‚Äôendurance sans surcharger les poumons.',
          points: 10,
          tips: ['Marchez √† votre rythme', 'Utilisez un oxym√®tre de pouls', 'Reposez-vous si essouffl√©'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.who.int/fr'],
        },
        // Hypothyro√Ødie
        {
          id: `conseil-${Date.now()}-${page}-17`,
          category: 'nutrition',
          disease: 'hypothyroidie',
          title: 'ü•ó Aliments riches en iode',
          description: 'L‚Äôiode soutient la fonction thyro√Ødienne dans l‚Äôhypothyro√Ødie.',
          points: 10,
          tips: ['Consommez des fruits de mer', 'Utilisez du sel iod√©', 'Consultez un endocrinologue'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.sante.fr'],
        },
        {
          id: `conseil-${Date.now()}-${page}-18`,
          category: 'prevention',
          disease: 'hypothyroidie',
          title: 'ü©∫ Suivi des niveaux hormonaux',
          description: 'Un suivi r√©gulier des hormones thyro√Ødiennes optimise le traitement.',
          points: 10,
          tips: ['Faites des analyses sanguines r√©guli√®res', 'Prenez vos m√©dicaments √† jeun', 'Signalez les sympt√¥mes √† votre m√©decin'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.who.int/fr'],
        },
        // Hyperthyro√Ødie
        {
          id: `conseil-${Date.now()}-${page}-19`,
          category: 'nutrition',
          disease: 'hyperthyroidie',
          title: 'ü•¶ Aliments anti-inflammatoires',
          description: 'Les l√©gumes crucif√®res aident √† r√©guler l‚Äôhyperthyro√Ødie.',
          points: 10,
          tips: ['Mangez du chou ou du brocoli', '√âvitez les aliments riches en iode', 'Consultez un di√©t√©ticien'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.sante.fr/nutrition'],
        },
        {
          id: `conseil-${Date.now()}-${page}-20`,
          category: 'prevention',
          disease: 'hyperthyroidie',
          title: 'üßò Gestion du stress',
          description: 'Le stress peut aggraver l‚Äôhyperthyro√Ødie; la relaxation aide √† le contr√¥ler.',
          points: 10,
          tips: ['Pratiquez la m√©ditation', 'Faites des exercices de respiration', '√âvitez les stimulants comme la caf√©ine'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.who.int/fr'],
        },
        // Ob√©sit√©
        {
          id: `conseil-${Date.now()}-${page}-21`,
          category: 'nutrition',
          disease: 'obesite',
          title: 'üçé Repas √©quilibr√©s pour l‚Äôob√©sit√©',
          description: 'Une alimentation √©quilibr√©e aide √† g√©rer le poids corporel.',
          points: 10,
          tips: ['Mangez des repas riches en l√©gumes', 'Limitez les sucres rapides', 'Consultez un nutritionniste'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.sante.fr/nutrition'],
        },
        {
          id: `conseil-${Date.now()}-${page}-22`,
          category: 'activite',
          disease: 'obesite',
          title: 'üö¥ Activit√© physique r√©guli√®re',
          description: 'L‚Äôexercice r√©gulier aide √† br√ªler des calories et √† am√©liorer la sant√©.',
          points: 15,
          tips: ['Faites 150 minutes d‚Äôexercice par semaine', 'Commencez par des activit√©s douces', 'Trouvez un partenaire d‚Äôentra√Ænement'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.who.int/fr'],
        },
        // Insuffisance r√©nale
        {
          id: `conseil-${Date.now()}-${page}-23`,
          category: 'nutrition',
          disease: 'insuffisance-renale',
          title: 'ü•ó R√©gime pauvre en sel',
          description: 'Un r√©gime pauvre en sel aide √† r√©duire la charge sur les reins.',
          points: 10,
          tips: ['√âvitez les aliments transform√©s', 'Utilisez des herbes pour assaisonner', 'Consultez un di√©t√©ticien'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.sante.fr/renal'],
        },
        {
          id: `conseil-${Date.now()}-${page}-24`,
          category: 'prevention',
          disease: 'insuffisance-renale',
          title: 'üíß Hydratation contr√¥l√©e',
          description: 'Une hydratation adapt√©e aide √† soutenir la fonction r√©nale.',
          points: 10,
          tips: ['Suivez les recommandations de votre m√©decin', '√âvitez les boissons sucr√©es', 'Surveillez votre apport en liquide'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.sante.fr'],
        },
        // N√©phropathie diab√©tique
        {
          id: `conseil-${Date.now()}-${page}-25`,
          category: 'prevention',
          disease: 'nephropathie-diabetique',
          title: 'ü©∫ Contr√¥le de la glyc√©mie',
          description: 'Un bon contr√¥le de la glyc√©mie prot√®ge les reins dans la n√©phropathie diab√©tique.',
          points: 10,
          tips: ['Surveillez votre glyc√©mie quotidiennement', 'Suivez votre traitement', 'Consultez un endocrinologue'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.sante.fr'],
        },
        {
          id: `conseil-${Date.now()}-${page}-26`,
          category: 'nutrition',
          disease: 'nephropathie-diabetique',
          title: 'ü•ï Aliments √† faible indice glyc√©mique',
          description: 'Les aliments √† faible indice glyc√©mique aident √† prot√©ger les reins.',
          points: 10,
          tips: ['Privil√©giez les l√©gumes verts', '√âvitez les sucres rapides', 'Planifiez vos repas'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.sante.fr/nutrition'],
        },
        // Parkinson
        {
          id: `conseil-${Date.now()}-${page}-27`,
          category: 'activite',
          disease: 'parkinson',
          title: 'üö∂‚Äç‚ôÇÔ∏è Exercices pour Parkinson',
          description: 'Les exercices physiques comme la marche aident √† am√©liorer la mobilit√© et l‚Äô√©quilibre.',
          points: 15,
          tips: ['Marchez 20 minutes par jour', 'Pratiquez le tai-chi', 'Consultez un kin√©sith√©rapeute'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.parkinson.org'],
        },
        {
          id: `conseil-${Date.now()}-${page}-28`,
          category: 'education',
          disease: 'parkinson',
          title: 'üß† Th√©rapie occupationnelle',
          description: 'La th√©rapie occupationnelle aide √† maintenir l‚Äôautonomie dans la maladie de Parkinson.',
          points: 10,
          tips: ['Travaillez avec un ergoth√©rapeute', 'Pratiquez des activit√©s manuelles', 'Adaptez votre environnement'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.parkinson.org'],
        },
        // Scl√©rose en plaques
        {
          id: `conseil-${Date.now()}-${page}-29`,
          category: 'activite',
          disease: 'sclerose-en-plaques',
          title: 'üèä Exercices √† faible impact',
          description: 'Les exercices √† faible impact aident √† maintenir la mobilit√© dans la scl√©rose en plaques.',
          points: 10,
          tips: ['Essayez le yoga ou la natation', '√âvitez la surchauffe', 'Reposez-vous apr√®s l‚Äôeffort'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.who.int/fr'],
        },
        {
          id: `conseil-${Date.now()}-${page}-30`,
          category: 'prevention',
          disease: 'sclerose-en-plaques',
          title: 'ü©∫ Gestion des sympt√¥mes',
          description: 'Un suivi r√©gulier aide √† g√©rer les pouss√©es de scl√©rose en plaques.',
          points: 10,
          tips: ['Consultez un neurologue r√©guli√®rement', 'Notez vos sympt√¥mes', '√âvitez le stress'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.mssociety.org.uk'],
        },
        // √âpilepsie
        {
          id: `conseil-${Date.now()}-${page}-31`,
          category: 'prevention',
          disease: 'epilepsie',
          title: 'üí§ Sommeil r√©gulier',
          description: 'Un sommeil suffisant r√©duit le risque de crises d‚Äô√©pilepsie.',
          points: 10,
          tips: ['Maintenez un horaire de sommeil r√©gulier', '√âvitez les stimulants avant le coucher', 'Consultez un neurologue'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.epilepsy.com'],
        },
        {
          id: `conseil-${Date.now()}-${page}-32`,
          category: 'education',
          disease: 'epilepsie',
          title: 'ü©∫ Respect des traitements',
          description: 'Prendre ses m√©dicaments r√©guli√®rement r√©duit les crises.',
          points: 10,
          tips: ['Utilisez un pilulier', 'Notez les effets secondaires', 'Consultez si des ajustements sont n√©cessaires'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.sante.fr'],
        },
        // Migraine chronique
        {
          id: `conseil-${Date.now()}-${page}-33`,
          category: 'prevention',
          disease: 'migraine-chronique',
          title: 'üßò √âviter les d√©clencheurs de migraine',
          description: 'Identifier et √©viter les d√©clencheurs r√©duit la fr√©quence des migraines.',
          points: 10,
          tips: ['Tenez un journal des migraines', '√âvitez les aliments riches en caf√©ine', 'Maintenez un horaire r√©gulier'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.migraine.com'],
        },
        {
          id: `conseil-${Date.now()}-${page}-34`,
          category: 'activite',
          disease: 'migraine-chronique',
          title: 'üßò Yoga pour les migraines',
          description: 'Le yoga aide √† r√©duire le stress et les migraines chroniques.',
          points: 10,
          tips: ['Pratiquez des postures douces', '√âvitez les positions invers√©es', 'Consultez un instructeur sp√©cialis√©'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.who.int/fr'],
        },
        // Lupus
        {
          id: `conseil-${Date.now()}-${page}-35`,
          category: 'education',
          disease: 'lupus',
          title: 'ü©∫ Gestion du lupus',
          description: 'Une gestion r√©guli√®re avec un rhumatologue aide √† contr√¥ler les sympt√¥mes du lupus.',
          points: 10,
          tips: ['√âvitez l‚Äôexposition prolong√©e au soleil', 'Suivez votre traitement', 'Reposez-vous suffisamment'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.lupus.org'],
        },
        {
          id: `conseil-${Date.now()}-${page}-36`,
          category: 'nutrition',
          disease: 'lupus',
          title: 'ü•ó Alimentation anti-inflammatoire',
          description: 'Une alimentation riche en antioxydants r√©duit l‚Äôinflammation li√©e au lupus.',
          points: 10,
          tips: ['Consommez des fruits rouges', 'Ajoutez du curcuma √† vos plats', '√âvitez les aliments transform√©s'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.sante.fr/nutrition'],
        },
        // Polyarthrite rhumato√Øde
        {
          id: `conseil-${Date.now()}-${page}-37`,
          category: 'activite',
          disease: 'polyarthrite-rhumatoide',
          title: 'üèä Exercices doux pour les articulations',
          description: 'Les exercices doux pr√©servent la mobilit√© dans la polyarthrite rhumato√Øde.',
          points: 10,
          tips: ['Essayez la natation', '√âvitez les mouvements brusques', 'Consultez un physioth√©rapeute'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.who.int/fr'],
        },
        {
          id: `conseil-${Date.now()}-${page}-38`,
          category: 'prevention',
          disease: 'polyarthrite-rhumatoide',
          title: 'ü©∫ Suivi rhumatologique',
          description: 'Un suivi r√©gulier aide √† g√©rer les pouss√©es de polyarthrite rhumato√Øde.',
          points: 10,
          tips: ['Prenez vos m√©dicaments comme prescrit', 'Signalez tout sympt√¥me nouveau', 'Reposez-vous pendant les pouss√©es'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.arthritis.org'],
        },
        // Maladie de Crohn
        {
          id: `conseil-${Date.now()}-${page}-39`,
          category: 'nutrition',
          disease: 'crohn',
          title: 'ü•ó R√©gime adapt√© pour Crohn',
          description: 'Un r√©gime adapt√© r√©duit les sympt√¥mes de la maladie de Crohn.',
          points: 10,
          tips: ['√âvitez les aliments riches en fibres pendant les pouss√©es', 'Consommez des repas fractionn√©s', 'Consultez un di√©t√©ticien'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.crohnscolitisfoundation.org'],
        },
        {
          id: `conseil-${Date.now()}-${page}-40`,
          category: 'prevention',
          disease: 'crohn',
          title: 'üßò Gestion du stress pour Crohn',
          description: 'Le stress peut aggraver les sympt√¥mes de Crohn; la relaxation aide.',
          points: 10,
          tips: ['Pratiquez la m√©ditation', 'Faites des exercices de respiration', 'Consultez un psychologue si n√©cessaire'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.who.int/fr'],
        },
        // Colite ulc√©reuse
        {
          id: `conseil-${Date.now()}-${page}-41`,
          category: 'nutrition',
          disease: 'colite-ulcereuse',
          title: 'üçé Alimentation douce pour la colite',
          description: 'Une alimentation douce r√©duit l‚Äôirritation dans la colite ulc√©reuse.',
          points: 10,
          tips: ['√âvitez les aliments √©pic√©s', 'Consommez des aliments cuits', 'Tenez un journal alimentaire'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.crohnscolitisfoundation.org'],
        },
        {
          id: `conseil-${Date.now()}-${page}-42`,
          category: 'prevention',
          disease: 'colite-ulcereuse',
          title: 'ü©∫ Suivi gastro-ent√©rologique',
          description: 'Un suivi r√©gulier aide √† g√©rer la colite ulc√©reuse.',
          points: 10,
          tips: ['Planifiez des coloscopies r√©guli√®res', 'Signalez les sympt√¥mes nouveaux', 'Suivez votre traitement'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.sante.fr'],
        },
        // Cancer du sein
        {
          id: `conseil-${Date.now()}-${page}-43`,
          category: 'education',
          disease: 'cancer-sein',
          title: 'ü©∫ D√©pistage pr√©coce du cancer du sein',
          description: 'Un d√©pistage r√©gulier peut d√©tecter le cancer √† un stade pr√©coce pour un meilleur traitement.',
          points: 10,
          tips: ['Planifiez des mammographies r√©guli√®res', 'Consultez pour tout sympt√¥me inhabituel', 'Informez-vous sur les facteurs de risque'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.cancer.org'],
        },
        {
          id: `conseil-${Date.now()}-${page}-44`,
          category: 'activite',
          disease: 'cancer-sein',
          title: 'üö∂ Activit√© physique pour la pr√©vention',
          description: 'L‚Äôexercice r√©duit le risque de r√©cidive du cancer du sein.',
          points: 10,
          tips: ['Marchez 30 minutes par jour', 'Essayez le yoga', 'Consultez votre m√©decin avant de commencer'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.cancer.org'],
        },
        // Cancer de la prostate
        {
          id: `conseil-${Date.now()}-${page}-45`,
          category: 'education',
          disease: 'cancer-prostate',
          title: 'ü©∫ D√©pistage du cancer de la prostate',
          description: 'Un d√©pistage r√©gulier aide √† d√©tecter le cancer de la prostate t√¥t.',
          points: 10,
          tips: ['Faites un test PSA annuel', 'Consultez un urologue', 'Discutez des ant√©c√©dents familiaux'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.cancer.org'],
        },
        {
          id: `conseil-${Date.now()}-${page}-46`,
          category: 'nutrition',
          disease: 'cancer-prostate',
          title: 'üçÖ Aliments riches en lycop√®ne',
          description: 'Le lycop√®ne, pr√©sent dans les tomates, peut r√©duire le risque de cancer de la prostate.',
          points: 10,
          tips: ['Mangez des tomates cuites', 'Ajoutez des l√©gumes rouges', '√âvitez les graisses satur√©es'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.sante.fr/nutrition'],
        },
        // Cancer du poumon
        {
          id: `conseil-${Date.now()}-${page}-47`,
          category: 'prevention',
          disease: 'cancer-poumon',
          title: 'üö≠ Arr√™ter de fumer',
          description: 'Cesser de fumer est crucial pour r√©duire le risque de cancer du poumon.',
          points: 15,
          tips: ['Consultez un sp√©cialiste', 'Utilisez des substituts nicotiniques', 'Rejoignez un groupe de soutien'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.cancer.org'],
        },
        {
          id: `conseil-${Date.now()}-${page}-48`,
          category: 'education',
          disease: 'cancer-poumon',
          title: 'ü©∫ D√©pistage pr√©coce',
          description: 'Un d√©pistage par scanner peut d√©tecter le cancer du poumon √† un stade pr√©coce.',
          points: 10,
          tips: ['Consultez un pneumologue', 'Discutez des ant√©c√©dents de tabagisme', 'Planifiez un d√©pistage si √† risque'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.cancer.org'],
        },
        // Leuc√©mie
        {
          id: `conseil-${Date.now()}-${page}-49`,
          category: 'prevention',
          disease: 'leucemie',
          title: 'ü©∫ Suivi h√©matologique',
          description: 'Un suivi r√©gulier aide √† surveiller les marqueurs de la leuc√©mie.',
          points: 10,
          tips: ['Faites des analyses sanguines r√©guli√®res', 'Signalez tout sympt√¥me', 'Consultez un h√©matologue'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.cancer.org'],
        },
        {
          id: `conseil-${Date.now()}-${page}-50`,
          category: 'nutrition',
          disease: 'leucemie',
          title: 'ü•ó Alimentation pour l‚Äôimmunit√©',
          description: 'Une alimentation riche en nutriments soutient le syst√®me immunitaire.',
          points: 10,
          tips: ['Consommez des fruits et l√©gumes', '√âvitez les aliments crus', 'Consultez un di√©t√©ticien'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.sante.fr/nutrition'],
        },
        // Arthrose
        {
          id: `conseil-${Date.now()}-${page}-51`,
          category: 'activite',
          disease: 'arthrose',
          title: 'üèä Natation pour l‚Äôarthrose',
          description: 'La natation soulage les douleurs articulaires en r√©duisant la pression sur les articulations.',
          points: 15,
          tips: ['Nagez 2 fois par semaine', 'Privil√©giez les piscines chauff√©es', 'Consultez un physioth√©rapeute'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.santepubliquefrance.fr'],
        },
        {
          id: `conseil-${Date.now()}-${page}-52`,
          category: 'nutrition',
          disease: 'arthrose',
          title: 'ü•ó Aliments anti-inflammatoires',
          description: 'Les aliments riches en om√©ga-3 r√©duisent l‚Äôinflammation articulaire.',
          points: 10,
          tips: ['Mangez du poisson gras', 'Ajoutez des noix √† votre alimentation', '√âvitez les aliments transform√©s'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.sante.fr/nutrition'],
        },
        // Ost√©oporose
        {
          id: `conseil-${Date.now()}-${page}-53`,
          category: 'nutrition',
          disease: 'osteoporose',
          title: 'ü•õ Calcium pour les os',
          description: 'Le calcium renforce les os et pr√©vient l‚Äôost√©oporose.',
          points: 10,
          tips: ['Consommez des produits laitiers', 'Ajoutez des l√©gumes verts', 'Consultez pour un suppl√©ment si n√©cessaire'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.sante.fr/nutrition'],
        },
        {
          id: `conseil-${Date.now()}-${page}-54`,
          category: 'activite',
          disease: 'osteoporose',
          title: 'üèãÔ∏è Exercices de renforcement',
          description: 'Les exercices de renforcement musculaire am√©liorent la densit√© osseuse.',
          points: 10,
          tips: ['Faites des exercices avec poids l√©gers', 'Marchez r√©guli√®rement', 'Consultez un physioth√©rapeute'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.who.int/fr'],
        },
        // Fibromyalgie
        {
          id: `conseil-${Date.now()}-${page}-55`,
          category: 'activite',
          disease: 'fibromyalgie',
          title: 'üßò Yoga pour la fibromyalgie',
          description: 'Le yoga aide √† r√©duire la douleur et √† am√©liorer la flexibilit√©.',
          points: 10,
          tips: ['Pratiquez des postures douces', '√âvitez la surchauffe', 'Consultez un instructeur sp√©cialis√©'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.sante.fr'],
        },
        {
          id: `conseil-${Date.now()}-${page}-56`,
          category: 'prevention',
          disease: 'fibromyalgie',
          title: 'üí§ Gestion du sommeil',
          description: 'Un sommeil de qualit√© r√©duit les sympt√¥mes de la fibromyalgie.',
          points: 10,
          tips: ['Maintenez un horaire r√©gulier', '√âvitez les √©crans avant le coucher', 'Cr√©ez un environnement calme'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.who.int/fr'],
        },
        // D√©pression
        {
          id: `conseil-${Date.now()}-${page}-57`,
          category: 'prevention',
          disease: 'depression',
          title: 'üßò‚Äç‚ôÄÔ∏è M√©ditation pour la sant√© mentale',
          description: 'La m√©ditation peut aider √† r√©duire les sympt√¥mes de la d√©pression.',
          points: 10,
          tips: ['Pratiquez 10 minutes par jour', 'Trouvez un endroit calme', 'Utilisez des applications de m√©ditation guid√©e'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.who.int/fr/mental-health'],
        },
        {
          id: `conseil-${Date.now()}-${page}-58`,
          category: 'activite',
          disease: 'depression',
          title: 'üö∂ Marche pour la d√©pression',
          description: 'La marche r√©guli√®re am√©liore l‚Äôhumeur et r√©duit les sympt√¥mes d√©pressifs.',
          points: 10,
          tips: ['Marchez 20 minutes par jour', 'Privil√©giez la nature', 'Marchez avec un ami'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.sante.fr'],
        },
        // Troubles anxieux
        {
          id: `conseil-${Date.now()}-${page}-59`,
          category: 'prevention',
          disease: 'troubles-anxieux',
          title: 'üßò Techniques de relaxation',
          description: 'Les techniques de relaxation r√©duisent l‚Äôanxi√©t√© g√©n√©ralis√©e.',
          points: 10,
          tips: ['Pratiquez la respiration profonde', 'Essayez la m√©ditation guid√©e', 'Consultez un th√©rapeute'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.who.int/fr/mental-health'],
        },
        {
          id: `conseil-${Date.now()}-${page}-60`,
          category: 'activite',
          disease: 'troubles-anxieux',
          title: 'üèÉ Activit√© physique pour l‚Äôanxi√©t√©',
          description: 'L‚Äôexercice physique aide √† r√©duire les sympt√¥mes d‚Äôanxi√©t√©.',
          points: 10,
          tips: ['Faites 30 minutes d‚Äôexercice mod√©r√©', 'Essayez le jogging', '√âvitez les stimulants comme la caf√©ine'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.sante.fr'],
        },
        // Schizophr√©nie
        {
          id: `conseil-${Date.now()}-${page}-61`,
          category: 'education',
          disease: 'schizophrenie',
          title: 'ü©∫ Suivi psychiatrique',
          description: 'Un suivi r√©gulier avec un psychiatre aide √† g√©rer la schizophr√©nie.',
          points: 10,
          tips: ['Prenez vos m√©dicaments comme prescrit', 'Notez les effets secondaires', 'Consultez r√©guli√®rement'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.sante.fr'],
        },
        {
          id: `conseil-${Date.now()}-${page}-62`,
          category: 'prevention',
          disease: 'schizophrenie',
          title: 'üßò Gestion du stress',
          description: 'R√©duire le stress aide √† minimiser les sympt√¥mes de la schizophr√©nie.',
          points: 10,
          tips: ['Pratiquez la relaxation', '√âvitez les situations stressantes', 'Rejoignez un groupe de soutien'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.who.int/fr/mental-health'],
        },
        // Trouble bipolaire
        {
          id: `conseil-${Date.now()}-${page}-63`,
          category: 'prevention',
          disease: 'trouble-bipolaire',
          title: 'üí§ Routine de sommeil',
          description: 'Une routine de sommeil stable aide √† g√©rer le trouble bipolaire.',
          points: 10,
          tips: ['Maintenez des horaires r√©guliers', '√âvitez les stimulants avant le coucher', 'Consultez un psychiatre'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.sante.fr'],
        },
        {
          id: `conseil-${Date.now()}-${page}-64`,
          category: 'education',
          disease: 'trouble-bipolaire',
          title: 'ü©∫ Suivi des humeurs',
          description: 'Tenir un journal des humeurs aide √† identifier les d√©clencheurs.',
          points: 10,
          tips: ['Notez vos √©motions quotidiennes', 'Partagez avec votre th√©rapeute', 'Utilisez une application d√©di√©e'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.who.int/fr/mental-health'],
        },
        // Cirrhose
        {
          id: `conseil-${Date.now()}-${page}-65`,
          category: 'nutrition',
          disease: 'cirrhose',
          title: 'üçè Alimentation saine pour le foie',
          description: 'Une alimentation √©quilibr√©e prot√®ge le foie et ralentit la progression de la cirrhose.',
          points: 10,
          tips: ['√âvitez l‚Äôalcool', 'Consommez des l√©gumes verts', 'Limitez les graisses satur√©es'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.who.int/fr'],
        },
        {
          id: `conseil-${Date.now()}-${page}-66`,
          category: 'prevention',
          disease: 'cirrhose',
          title: 'ü©∫ Vaccination h√©patique',
          description: 'Les vaccins contre l‚Äôh√©patite prot√®gent le foie dans la cirrhose.',
          points: 10,
          tips: ['V√©rifiez votre statut vaccinal', 'Consultez un h√©patologue', '√âvitez les infections'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.sante.fr'],
        },
        // Psoriasis
        {
          id: `conseil-${Date.now()}-${page}-67`,
          category: 'prevention',
          disease: 'psoriasis',
          title: 'üß¥ Hydratation de la peau',
          description: 'Une peau bien hydrat√©e r√©duit les sympt√¥mes du psoriasis.',
          points: 10,
          tips: ['Utilisez des cr√®mes √©mollientes', '√âvitez les douches chaudes', 'Consultez un dermatologue'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.psoriasis.org'],
        },
        {
          id: `conseil-${Date.now()}-${page}-68`,
          category: 'nutrition',
          disease: 'psoriasis',
          title: 'ü•ó Alimentation anti-inflammatoire',
          description: 'Une alimentation riche en antioxydants r√©duit l‚Äôinflammation du psoriasis.',
          points: 10,
          tips: ['Consommez des poissons gras', 'Ajoutez des fruits rouges', '√âvitez les aliments transform√©s'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.sante.fr/nutrition'],
        },
        // Endom√©triose
        {
          id: `conseil-${Date.now()}-${page}-69`,
          category: 'prevention',
          disease: 'endometriose',
          title: 'ü©∫ Suivi gyn√©cologique',
          description: 'Un suivi r√©gulier aide √† g√©rer les sympt√¥mes de l‚Äôendom√©triose.',
          points: 10,
          tips: ['Consultez un gyn√©cologue r√©guli√®rement', 'Notez vos douleurs', 'Discutez des options de traitement'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.sante.fr'],
        },
        {
          id: `conseil-${Date.now()}-${page}-70`,
          category: 'nutrition',
          disease: 'endometriose',
          title: 'ü•ó R√©gime anti-inflammatoire',
          description: 'Une alimentation anti-inflammatoire peut r√©duire les douleurs de l‚Äôendom√©triose.',
          points: 10,
          tips: ['Consommez des l√©gumes verts', '√âvitez les aliments transform√©s', 'Ajoutez des om√©ga-3'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.sante.fr/nutrition'],
        },
        // VIH
        {
          id: `conseil-${Date.now()}-${page}-71`,
          category: 'education',
          disease: 'vih',
          title: 'üìö Sensibilisation au VIH',
          description: 'Conna√Ætre les modes de transmission du VIH aide √† mieux se prot√©ger.',
          points: 10,
          tips: ['Informez-vous aupr√®s de sources fiables', 'Participez √† des campagnes locales', 'Consultez r√©guli√®rement'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.unaids.org/fr'],
        },
        {
          id: `conseil-${Date.now()}-${page}-72`,
          category: 'prevention',
          disease: 'vih',
          title: 'ü©∫ Adh√©rence au traitement',
          description: 'Prendre son traitement antir√©troviral r√©guli√®rement maintient une charge virale ind√©tectable.',
          points: 10,
          tips: ['Utilisez un pilulier', 'Planifiez vos prises', 'Consultez un infectiologue'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.sante.fr'],
        },
        // G√©n√©ral
        {
          id: `conseil-${Date.now()}-${page}-73`,
          category: 'prevention',
          disease: 'general',
          title: 'üß¥ Protection solaire',
          description: 'Utilisez une cr√®me solaire pour prot√©ger votre peau des rayons UV.',
          points: 5,
          tips: ['Appliquez toutes les 2 heures', 'Portez un chapeau', '√âvitez le soleil entre 12h et 16h'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.santepubliquefrance.fr'],
        },
        {
          id: `conseil-${Date.now()}-${page}-74`,
          category: 'activite',
          disease: 'general',
          title: 'üö∂ Activit√© physique quotidienne',
          description: 'Une activit√© physique r√©guli√®re am√©liore la sant√© globale.',
          points: 10,
          tips: ['Marchez 30 minutes par jour', 'Essayez des activit√©s vari√©es', 'Fixez des objectifs r√©alistes'],
          dateAdded: new Date().toISOString().split('T')[0],
          relatedLinks: ['https://www.who.int/fr'],
        },
      ];

      const existingIds = conseils.map(c => c.id);
      const newConseils = conseilPool.filter(c => !existingIds.includes(c.id));
      const updatedConseils = page === 1 ? newConseils : [...conseils, ...newConseils];
      await AsyncStorage.setItem('cachedConseils', JSON.stringify(updatedConseils));
      return updatedConseils;
    } catch (error) {
      console.error('Erreur r√©cup√©ration conseils:', error);
      const cached = await AsyncStorage.getItem('cachedConseils');
      return cached ? JSON.parse(cached) : [];
    } finally {
      setLoading(false);
    }
  };

  const fetchQuizzes = async (page: number): Promise<Quiz[]> => {
    setLoading(true);
    try {
      await new Promise(resolve => setTimeout(resolve, 1000));
      
      const quizPool: Quiz[] = [
        {
          id: `quiz-${Date.now()}-${page}-1`,
          question: 'üçé Quel fruit est recommand√© pour le diab√®te ?',
          options: ['Mangue', 'Banane', 'Pomme', 'Raisin'],
          correctAnswer: 'Pomme',
          disease: 'diabete',
          explanation: 'Les pommes ont un index glyc√©mique mod√©r√© et sont riches en fibres.',
          points: 15,
          timeLimit: 30,
        },
        {
          id: `quiz-${Date.now()}-${page}-2`,
          question: 'üßò Quel exercice r√©duit le stress ?',
          options: ['Yoga', 'Course rapide', 'Halt√©rophilie', 'Natation'],
          correctAnswer: 'Yoga',
          disease: 'hypertension',
          explanation: 'Le yoga combine respiration et mouvements doux pour r√©duire le stress.',
          points: 20,
          timeLimit: 40,
        },
        {
          id: `quiz-${Date.now()}-${page}-3`,
          question: 'üíâ Pourquoi les vaccins sont-ils importants ?',
          options: ['Pour perdre du poids', 'Pour pr√©venir les maladies', 'Pour augmenter la force', 'Pour am√©liorer la vue'],
          correctAnswer: 'Pour pr√©venir les maladies',
          disease: 'general',
          explanation: 'Les vaccins prot√®gent contre de nombreuses maladies infectieuses.',
          points: 10,
          timeLimit: 25,
        },
        {
          id: `quiz-${Date.now()}-${page}-4`,
          question: 'ü©∫ √Ä quelle fr√©quence v√©rifier sa tension ?',
          options: ['Une fois par an', 'Tous les mois', 'Tous les jours', 'Une fois par semaine'],
          correctAnswer: 'Tous les mois',
          disease: 'hypertension',
          explanation: 'Un contr√¥le mensuel permet de surveiller efficacement la tension art√©rielle.',
          points: 15,
          timeLimit: 35,
        },
        {
          id: `quiz-${Date.now()}-${page}-5`,
          question: 'üå¨Ô∏è Quel est un d√©clencheur courant de l‚Äôasthme ?',
          options: ['Sucre', 'Poussi√®re', 'Eau', 'L√©gumes'],
          correctAnswer: 'Poussi√®re',
          disease: 'asthme',
          explanation: 'La poussi√®re peut d√©clencher des crises d‚Äôasthme en irritant les voies respiratoires.',
          points: 15,
          timeLimit: 30,
        },
        {
          id: `quiz-${Date.now()}-${page}-6`,
          question: 'üß† Quel sympt√¥me est courant dans la maladie de Parkinson ?',
          options: ['Tremblements', 'Perte de cheveux', 'Fi√®vre', 'Toux'],
          correctAnswer: 'Tremblements',
          disease: 'parkinson',
          explanation: 'Les tremblements sont un sympt√¥me caract√©ristique de la maladie de Parkinson.',
          points: 20,
          timeLimit: 40,
        },
        {
          id: `quiz-${Date.now()}-${page}-7`,
          question: 'ü©∫ Quel est un facteur de risque du cancer du sein ?',
          options: ['Boire de l‚Äôeau', 'Tabagisme', 'Exercice physique', 'Ant√©c√©dents familiaux'],
          correctAnswer: 'Ant√©c√©dents familiaux',
          disease: 'cancer-sein',
          explanation: 'Les ant√©c√©dents familiaux augmentent le risque de cancer du sein.',
          points: 15,
          timeLimit: 35,
        },
        {
          id: `quiz-${Date.now()}-${page}-8`,
          question: 'ü•ó Quel nutriment limiter pour l‚Äôinsuffisance r√©nale ?',
          options: ['Sucre', 'Sel', 'Vitamine C', 'Fibres'],
          correctAnswer: 'Sel',
          disease: 'insuffisance-renale',
          explanation: 'R√©duire le sel aide √† g√©rer la pression sur les reins.',
          points: 15,
          timeLimit: 30,
        },
        {
          id: `quiz-${Date.now()}-${page}-9`,
          question: 'üßò‚Äç‚ôÄÔ∏è Quelle activit√© aide √† g√©rer la d√©pression ?',
          options: ['M√©ditation', 'Jeux vid√©o', 'Consommation d‚Äôalcool', 'Fumer'],
          correctAnswer: 'M√©ditation',
          disease: 'depression',
          explanation: 'La m√©ditation r√©duit les sympt√¥mes de la d√©pression en favorisant la relaxation.',
          points: 10,
          timeLimit: 30,
        },
        {
          id: `quiz-${Date.now()}-${page}-10`,
          question: 'üèä Quelle activit√© est b√©n√©fique pour l‚Äôarthrose ?',
          options: ['Course √† pied', 'Natation', 'Halt√©rophilie', 'Escalade'],
          correctAnswer: 'Natation',
          disease: 'arthrose',
          explanation: 'La natation r√©duit la pression sur les articulations tout en am√©liorant la mobilit√©.',
          points: 15,
          timeLimit: 35,
        },
      ];

      const existingIds = quizzes.map(q => q.id);
      const newQuizzes = quizPool.filter(q => !existingIds.includes(q.id));
      const updatedQuizzes = page === 1 ? newQuizzes : [...quizzes, ...newQuizzes];
      await AsyncStorage.setItem('cachedQuizzes', JSON.stringify(updatedQuizzes));
      return updatedQuizzes;
    } catch (error) {
      console.error('Erreur r√©cup√©ration quiz:', error);
      const cached = await AsyncStorage.getItem('cachedQuizzes');
      return cached ? JSON.parse(cached) : [];
    } finally {
      setLoading(false);
    }
  };

  function getWeekEnd(): string {
    const now = new Date();
    const daysUntilSunday = 7 - now.getDay();
    const weekEnd = new Date(now);
    weekEnd.setDate(now.getDate() + daysUntilSunday);
    return weekEnd.toDateString();
  }

  function getMonthEnd(): string {
    const now = new Date();
    const monthEnd = new Date(now.getFullYear(), now.getMonth() + 1, 0);
    return monthEnd.toDateString();
  }




const requestMicrophonePermission = async () => {
  if (Platform.OS === 'android') {
    try {
      const granted = await PermissionsAndroid.request(
        PermissionsAndroid.PERMISSIONS.RECORD_AUDIO,
        {
          title: 'Microphone Permission',
          message: 'This app needs access to your microphone to enable voice recognition.',
          buttonNeutral: 'Ask Me Later',
          buttonNegative: 'Cancel',
          buttonPositive: 'OK',
        }
      );
      return granted === PermissionsAndroid.RESULTS.GRANTED;
    } catch (err) {
      console.warn('Permission error:', err);
      return false;
    }
  }
  return true;
};

const startRecording = async () => {
  if (!Voice || !Voice._loaded) {
    console.error('Voice module is not loaded');
    Alert.alert('Erreur', 'Module de reconnaissance vocale non charg√©.');
    speak('Module de reconnaissance vocale non charg√©.', 'fr-FR');
    return;
  }
  const hasPermission = await requestMicrophonePermission();
  if (!hasPermission) {
    Alert.alert('Permission refus√©e', 'Veuillez autoriser l‚Äôacc√®s au microphone.');
    speak('Veuillez autoriser l‚Äôacc√®s au microphone.', 'fr-FR');
    return;
  }
  try {
    await Voice.start('fr-FR');
    setIsRecording(true);
  } catch (error) {
    console.error('Erreur d√©marrage reconnaissance vocale:', error);
    Alert.alert('Erreur', 'Impossible de d√©marrer la reconnaissance vocale.');
    speak('Erreur lors du d√©marrage de la reconnaissance vocale.', 'fr-FR');
  }
};

useEffect(() => {
  console.log('Voice module:', Voice);
  loadProgress();
  updateStreak();
  fetchInitialData();

  const initializeVoice = async () => {
    if (!Voice) {
      console.error('Voice module is undefined');
      Alert.alert('Erreur', 'Module de reconnaissance vocale non disponible.');
      speak('Module de reconnaissance vocale non disponible.', 'fr-FR');
      return;
    }

    // Wait for the module to load
    let attempts = 0;
    while (!Voice._loaded && attempts < 5) {
      console.log('Waiting for Voice module to load...');
      await new Promise(resolve => setTimeout(resolve, 500));
      attempts++;
    }
    if (!Voice._loaded) {
      console.error('Voice module failed to load after retries');
      Alert.alert('Erreur', 'Module de reconnaissance vocale non charg√©.');
      speak('Module de reconnaissance vocale non charg√©.', 'fr-FR');
      return;
    }

    // Set up event listeners
    Voice.onSpeechStart = () => {
      console.log('Speech recognition started');
      setIsRecording(true);
    };
    Voice.onSpeechEnd = () => {
      console.log('Speech recognition ended');
      setIsRecording(false);
    };
    Voice.onSpeechError = (e: any) => {
      console.error('Speech recognition error:', e);
      setIsRecording(false);
      Alert.alert('Erreur', 'Impossible de reconna√Ætre la parole. Veuillez r√©essayer.');
      speak('Erreur de reconnaissance vocale. Veuillez r√©essayer.', 'fr-FR');
    };
    Voice.onSpeechResults = (e: any) => {
      console.log('Speech recognition results:', e);
      const text = e.value[0]?.toLowerCase();
      setRecognizedText(text);
      handleVoiceAnswer(text);
    };
  };

  initializeVoice();

  return () => {
    if (Voice) {
      Voice.destroy().then(() => {
        console.log('Voice module destroyed');
        Voice.removeAllListeners();
      });
    }
  };
}, []);

  useEffect(() => {
    updateBadges();
    updateChallenges();
    saveProgress();
    checkQuizCompletion();
  }, [userPoints, completedQuizzes, favoriteConseils]);

  const fetchInitialData = async () => {
    const initialConseils = await fetchConseils(1);
    const initialQuizzes = await fetchQuizzes(1);
    setConseils(initialConseils);
    setQuizzes(initialQuizzes);
  };

  const checkQuizCompletion = () => {
    if (quizzes.length > 0 && quizzes.every(quiz => completedQuizzes.includes(quiz.id))) {
      Alert.alert(
        'Quiz termin√©s !',
        'Vous avez compl√©t√© tous les quiz disponibles. Voulez-vous charger plus de quiz ?',
        [
          { text: 'Annuler', style: 'cancel' },
          {
            text: 'Charger',
            onPress: async () => {
              setPageQuizzes(1);
              const newQuizzes = await fetchQuizzes(1);
              setQuizzes(newQuizzes);
              setCompletedQuizzes([]);
              speak('Quiz charg√©s !', 'fr-FR');
            },
          },
        ]
      );
    }
  };

  const updateStreak = () => {
    const today = new Date().toDateString();
    const yesterday = new Date();
    yesterday.setDate(yesterday.getDate() - 1);

    if (userProgress.lastVisit === today) {
      return;
    } else if (userProgress.lastVisit === yesterday.toDateString()) {
      setUserProgress(prev => ({
        ...prev,
        streak: prev.streak + 1,
        lastVisit: today,
        completedToday: 0,
      }));
    } else {
      setUserProgress(prev => ({
        ...prev,
        streak: 1,
        lastVisit: today,
        completedToday: 0,
      }));
    }
  };

  const loadProgress = async () => {
    try {
      const points = await AsyncStorage.getItem('userPoints');
      const completed = await AsyncStorage.getItem('completedQuizzes');
      const favorites = await AsyncStorage.getItem('favoriteConseils');
      const badgesData = await AsyncStorage.getItem('unlockedBadges');
      const progressData = await AsyncStorage.getItem('userProgress');

      if (points) setUserPoints(parseInt(points));
      if (completed) setCompletedQuizzes(JSON.parse(completed));
      if (favorites) setFavoriteConseils(JSON.parse(favorites));
      if (progressData) setUserProgress(JSON.parse(progressData));

      if (badgesData) {
        const unlockedIds = JSON.parse(badgesData);
        setBadges(prev =>
          prev.map(badge => ({
            ...badge,
            unlocked: unlockedIds.includes(badge.id),
          }))
        );
      }
    } catch (error) {
      console.error('Erreur chargement progression:', error);
    }
  };

  const saveProgress = async () => {
    try {
      await AsyncStorage.setItem('userPoints', userPoints.toString());
      await AsyncStorage.setItem('completedQuizzes', JSON.stringify(completedQuizzes));
      await AsyncStorage.setItem('favoriteConseils', JSON.stringify(favoriteConseils));
      await AsyncStorage.setItem('userProgress', JSON.stringify(userProgress));

      const unlockedIds = badges.filter(b => b.unlocked).map(b => b.id);
      await AsyncStorage.setItem('unlockedBadges', JSON.stringify(unlockedIds));
    } catch (error) {
      console.error('Erreur sauvegarde progression:', error);
    }
  };

  const updateBadges = () => {
    const updatedBadges = badges.map(badge => {
      if (!badge.unlocked) {
        let shouldUnlock = false;

        if (badge.requiredPoints > 0 && userPoints >= badge.requiredPoints) {
          shouldUnlock = true;
        }

        if (badge.id === 'assidu' && userProgress.streak >= 7) {
          shouldUnlock = true;
        }

        if (badge.id === 'quizmaster' && completedQuizzes.length >= 10) {
          shouldUnlock = true;
        }

        if (shouldUnlock) {
          speak(`F√©licitations ! Vous avez d√©bloqu√© le badge ${badge.name}`, 'fr-FR');
          return { ...badge, unlocked: true, dateUnlocked: new Date().toISOString() };
        }
      }
      return badge;
    });

    if (JSON.stringify(updatedBadges) !== JSON.stringify(badges)) {
      setBadges(updatedBadges);
    }
  };

  const updateChallenges = () => {
    const updatedChallenges = challenges.map(challenge => {
      let current = challenge.current;
      if (challenge.id === 'daily1') {
        current = userProgress.completedToday;
      } else if (challenge.id === 'weekly1') {
        current = favoriteConseils.length;
      } else if (challenge.id === 'monthly1') {
        current = userPoints;
      }
      if (current >= challenge.target && challenge.current < challenge.target) {
        setUserPoints(prev => prev + challenge.reward);
        speak(`F√©licitations ! D√©fi ${challenge.title} compl√©t√© ! +${challenge.reward} points`, 'fr-FR');
        Alert.alert('D√©fi r√©ussi !', `Vous avez compl√©t√© ${challenge.title} et gagn√© ${challenge.reward} points !`);
      }
      return { ...challenge, current };
    });
    setChallenges(updatedChallenges);
  };

  const handleQuizAnswer = (quiz: Quiz, selectedOption: string) => {
    if (completedQuizzes.includes(quiz.id)) {
      Alert.alert('D√©j√† compl√©t√©', 'Vous avez d√©j√† r√©pondu √† ce quiz !');
      return;
    }

    if (selectedOption === quiz.correctAnswer) {
      const newPoints = userPoints + quiz.points;
      setUserPoints(newPoints);
      setCompletedQuizzes(prev => [...prev, quiz.id]);

      setUserProgress(prev => ({
        ...prev,
        completedToday: prev.completedToday + 1,
        monthlyStats: {
          ...prev.monthlyStats,
          [new Date().toISOString().split('T')[0]]: (prev.monthlyStats[new Date().toISOString().split('T')[0]] || 0) + 1,
        },
      }));

      Animated.sequence([
        Animated.timing(fadeAnim, { toValue: 0.5, duration: 200, useNativeDriver: true }),
        Animated.timing(fadeAnim, { toValue: 1, duration: 200, useNativeDriver: true }),
      ]).start();

      Alert.alert(
        'üéâ Excellent !',
        `Bonne r√©ponse ! +${quiz.points} points\n\nüí° ${quiz.explanation}`,
        [{ text: 'Continuer', onPress: saveProgress }]
      );
      speak(`Bonne r√©ponse ! Vous gagnez ${quiz.points} points. ${quiz.explanation}`, 'fr-FR');
    } else {
      Alert.alert('‚ùå Pas tout √† fait', `La bonne r√©ponse √©tait : ${quiz.correctAnswer}\n\nüí° ${quiz.explanation}`);
      speak(`R√©ponse incorrecte. La bonne r√©ponse √©tait ${quiz.correctAnswer}. ${quiz.explanation}`, 'fr-FR');
    }
  };

  const handleVoiceAnswer = (text: string) => {
    if (!selectedQuiz) return;

    const normalizedText = text.toLowerCase().trim();
    const matchedOption = selectedQuiz.options.find(option =>
      option.toLowerCase().includes(normalizedText) || normalizedText.includes(option.toLowerCase())
    );

    if (matchedOption) {
      handleQuizAnswer(selectedQuiz, matchedOption);
    } else {
      Alert.alert('Non reconnu', 'Votre r√©ponse n‚Äôa pas √©t√© reconnue. Veuillez r√©essayer.');
      speak('R√©ponse non reconnue. Veuillez r√©essayer.', 'fr-FR');
    }
  };

  const toggleFavorite = (conseilId: string) => {
    setFavoriteConseils(prev => {
      if (prev.includes(conseilId)) {
        speak('Conseil retir√© des favoris', 'fr-FR');
        return prev.filter(id => id !== conseilId);
      } else {
        setUserPoints(prev => prev + 5);
        speak('Conseil ajout√© aux favoris', 'fr-FR');
        return [...prev, conseilId];
      }
    });
  };

  const shareConseil = async (conseil: Conseil) => {
    try {
      const message = `üåü Conseil Sant√© Yafa üåü\n\n${conseil.title}\n\n${conseil.description}\n\nüì± T√©l√©chargez l'app Yafa pour plus de conseils sant√© !`;

      await Share.share({
        message: message,
        title: 'Conseil Sant√© Yafa',
      });

      setUserPoints(prev => prev + 5);
      const shareCount = (badges.find(b => b.id === 'partageur')?.requiredPoints || 0) + 1;
      if (shareCount >= 5) {
        setBadges(prev => prev.map(b => (b.id === 'partageur' ? { ...b, unlocked: true, dateUnlocked: new Date().toISOString() } : b)));
        speak('Badge Ambassadeur Sant√© d√©bloqu√© !', 'fr-FR');
      }
      speak('Merci de partager nos conseils sant√© !', 'fr-FR');
    } catch (error) {
      console.error('Erreur partage:', error);
    }
  };

  const onRefresh = async () => {
    setRefreshing(true);
    setPageConseils(1);
    setPageQuizzes(1);
    setCompletedQuizzes([]);
    const newConseils = await fetchConseils(1);
    const newQuizzes = await fetchQuizzes(1);
    setConseils(newConseils);
    setQuizzes(newQuizzes);
    setRefreshing(false);
    speak('Contenu mis √† jour', 'fr-FR');
  };

  const loadMoreConseils = async () => {
    if (!loading) {
      const nextPage = pageConseils + 1;
      setPageConseils(nextPage);
      const newConseils = await fetchConseils(nextPage);
      setConseils(newConseils);
      speak('Plus de conseils charg√©s !', 'fr-FR');
    }
  };

  const loadMoreQuizzes = async () => {
    if (!loading) {
      const nextPage = pageQuizzes + 1;
      setPageQuizzes(nextPage);
      const newQuizzes = await fetchQuizzes(nextPage);
      setQuizzes(newQuizzes);
      speak('Plus de quiz charg√©s !', 'fr-FR');
    }
  };

  const filteredConseils = conseils.filter(conseil =>
    (selectedFilter === 'all' || conseil.disease === selectedFilter) &&
    (searchQuery === '' ||
      conseil.title.toLowerCase().includes(searchQuery.toLowerCase()) ||
      conseil.description.toLowerCase().includes(searchQuery.toLowerCase()))
  );

  const filteredQuizzes = quizzes.filter
  (quiz =>
(selectedFilter === 'all' || quiz.disease === selectedFilter) &&
(searchQuery === '' ||
quiz.question.toLowerCase().includes(searchQuery.toLowerCase()) ||
quiz.explanation.toLowerCase().includes(searchQuery.toLowerCase()))
);


const stopRecording = async () => {
try {
await Voice.stop();
setIsRecording(false);
} catch (error) {
console.error('Erreur arr√™t reconnaissance vocale:', error);
Alert.alert('Erreur', 'Impossible d‚Äôarr√™ter la reconnaissance vocale.');
speak('Erreur lors de l‚Äôarr√™t de la reconnaissance vocale.', 'fr-FR');
}
};

const renderConseilItem = ({ item }: { item: Conseil }) => (
<TouchableOpacity
  style={styles.conseilCard}
  onPress={() => {
    setSelectedConseil(item);
    setShowDetailsModal(true);
    speak(item.title, 'fr-FR');
  }}
>
  <View style={styles.conseilHeader}>
    <Text style={styles.conseilTitle}>{item.title}</Text>
    <TouchableOpacity onPress={() => toggleFavorite(item.id)}>
      <MaterialIcons
        name={favoriteConseils.includes(item.id) ? 'favorite' : 'favorite-border'}
        size={24}
        color={favoriteConseils.includes(item.id) ? '#ff5252' : '#757575'}
      />
    </TouchableOpacity>
  </View>
  <Text style={styles.conseilDescription} numberOfLines={2}>
    {item.description}
  </Text>
  <View style={styles.conseilFooter}>
    <Text style={styles.conseilPoints}>+{item.points} points</Text>
    <TouchableOpacity onPress={() => shareConseil(item)}>
      <MaterialIcons name="share" size={20} color="#2196F3" />
    </TouchableOpacity>
  </View>
</TouchableOpacity>
);
const renderQuizItem = ({ item }: { item: Quiz }) => (
  <TouchableOpacity
    style={[styles.quizCard, completedQuizzes.includes(item.id) && styles.completedQuiz]}
    onPress={() => {
      setSelectedQuiz(item);
      speak(item.question, 'fr-FR');
    }}
    disabled={completedQuizzes.includes(item.id)}
    activeOpacity={0.8}
  >
    <Text style={styles.quizQuestion}>{item.question}</Text>
    <View style={styles.quizOptions}>
      {item.options.map((option, index) => (
        <TouchableOpacity
          key={index}
          style={styles.quizOption}
          onPress={() => handleQuizAnswer(item, option)}
          disabled={completedQuizzes.includes(item.id)}
        >
          <Text style={styles.quizOptionText}>{option}</Text>
        </TouchableOpacity>
      ))}
    </View>
    <Text style={styles.quizPoints}>+{item.points} points</Text>
    {item.timeLimit && (
      <Text style={styles.quizTimeLimit}>Temps: {item.timeLimit}s</Text>
    )}
  </TouchableOpacity>
);

const renderBadgeItem = ({ item }: { item: Badge }) => (
  <View style={[styles.badgeCard, { backgroundColor: item.unlocked ? item.color : '#E0E0E0' }]}>
    <MaterialIcons name={item.icon as any} size={40} color={item.unlocked ? '#FFF' : '#757575'} />
    <Text style={[styles.badgeName, { color: item.unlocked ? '#FFF' : '#757575' }]}>
      {item.name}
    </Text>
    <Text style={[styles.badgeDescription, { color: item.unlocked ? '#FFF' : '#757575' }]}>
      {item.description}
    </Text>
    {item.unlocked && item.dateUnlocked && (
      <Text style={styles.badgeDate}>
        D√©bloqu√© le {new Date(item.dateUnlocked).toLocaleDateString('fr-FR')}
      </Text>
    )}
  </View>
);

const renderChallengeItem = ({ item }: { item: Challenge }) => (
  <View style={styles.challengeCard}>
    <Text style={styles.challengeTitle}>{item.title}</Text>
    <Text style={styles.challengeDescription}>{item.description}</Text>
    <Text style={styles.challengeProgress}>
      Progr√®s: {item.current}/{item.target}
    </Text>
    <Text style={styles.challengeReward}>R√©compense: {item.reward} points</Text>
    <Text style={styles.challengeDeadline}>√âch√©ance: {item.deadline}</Text>
  </View>
);
const renderProgress = () => (
  <View style={styles.progressContainer}>
    <Text style={styles.progressTitle}>Votre Progression</Text>
    <Text style={styles.progressText}>Points totaux: {userPoints}</Text>
    <Text style={styles.progressText}>S√©rie de jours: {userProgress.streak}</Text>
    <Text style={styles.progressText}>Quiz compl√©t√©s aujourd'hui: {userProgress.completedToday}</Text>
    <Text style={styles.progressText}>Objectif hebdomadaire: {userProgress.weeklyGoal} conseils</Text>
    <Text style={styles.progressTitle}>Statistiques Mensuelles</Text>
    {Object.entries(userProgress.monthlyStats).map(([date, count]) => (
      <Text key={date} style={styles.progressText}>
        {date}: {count} quiz compl√©t√©s
      </Text>
    ))}
  </View>
);
const handleTabSwitch = (tab: 'conseils' | 'quiz' | 'badges' | 'progress' | 'challenges') => {
  setActiveTab(tab);
  Animated.timing(tabAnim, {
    toValue: ['conseils', 'quiz', 'badges', 'progress', 'challenges'].indexOf(tab) * (width / 5),
    duration: 300,
    useNativeDriver: true,
  }).start();
  speak(`Onglet ${tab} s√©lectionn√©`, 'fr-FR');
};

return (
  <View style={styles.container}>
    <View style={styles.header}>
      <Text style={styles.headerTitle}>Yafa Sant√©</Text>
      <Text style={styles.points}>Points: {userPoints}</Text>
    </View>

    <View style={styles.searchContainer}>
      <TextInput
        style={styles.searchInput}
        placeholder="Rechercher conseils ou quiz..."
        value={searchQuery}
        onChangeText={setSearchQuery}
      />
      <TouchableOpacity onPress={startRecording} style={styles.micButton}>
        <MaterialIcons
          name={isRecording ? 'mic' : 'mic-off'}
          size={24}
          color={isRecording ? '#ff5252' : '#757575'}
        />
      </TouchableOpacity>
    </View>

    <View style={styles.filterContainer}>
      <ScrollView horizontal showsHorizontalScrollIndicator={false}>
        <TouchableOpacity
          style={[styles.filterButton, selectedFilter === 'all' && styles.activeFilter]}
          onPress={() => setSelectedFilter('all')}
        >
          <Text style={styles.filterText}>Tous</Text>
        </TouchableOpacity>
        {[...new Set(conseils.map(c => c.disease))].map(disease => (
          <TouchableOpacity
            key={disease}
            style={[styles.filterButton, selectedFilter === disease && styles.activeFilter]}
            onPress={() => setSelectedFilter(disease as Disease)}
          >
            <Text style={styles.filterText}>{disease}</Text>
          </TouchableOpacity>
        ))}
      </ScrollView>
    </View>

    <View style={styles.tabContainer}>
      {['conseils', 'quiz', 'badges', 'progress', 'challenges'].map(tab => (
        <TouchableOpacity
          key={tab}
          style={styles.tabButton}
          onPress={() => handleTabSwitch(tab as 'conseils' | 'quiz' | 'badges' | 'progress' | 'challenges')}
        >
          <Text style={[styles.tabText, activeTab === tab && styles.activeTabText]}>
            {tab.charAt(0).toUpperCase() + tab.slice(1)}
          </Text>
        </TouchableOpacity>
      ))}
      <Animated.View
        style={[
          styles.tabIndicator,
          { transform: [{ translateX: tabAnim }] },
        ]}
      />
    </View>
    <Animated.View style={[styles.contentContainer, { opacity: fadeAnim }]}>
      {loading && <ActivityIndicator size="large" color="#2196F3" />}
      {activeTab === 'conseils' && (
        <FlatList
          data={filteredConseils}
          renderItem={renderConseilItem}
          keyExtractor={item => item.id}
          refreshControl={<RefreshControl refreshing={refreshing} onRefresh={onRefresh} />}
          onEndReached={loadMoreConseils}
          onEndReachedThreshold={0.5}
          ListEmptyComponent={<Text style={styles.emptyText}>Aucun conseil trouv√©.</Text>}
        />
      )}
      {activeTab === 'quiz' && (
        <FlatList
          data={filteredQuizzes}
          renderItem={renderQuizItem}
          keyExtractor={item => item.id}
          refreshControl={<RefreshControl refreshing={refreshing} onRefresh={onRefresh} />}
          onEndReached={loadMoreQuizzes}
          onEndReachedThreshold={0.5}
          ListEmptyComponent={<Text style={styles.emptyText}>Aucun quiz trouv√©.</Text>}
        />
      )}
      {activeTab === 'badges' && (
        <FlatList
          data={badges}
          renderItem={renderBadgeItem}
          keyExtractor={item => item.id}
          numColumns={2}
          ListEmptyComponent={<Text style={styles.emptyText}>Aucun badge disponible.</Text>}
        />
      )}
      {activeTab === 'progress' && renderProgress()}
      {activeTab === 'challenges' && (
        <FlatList
          data={challenges}
          renderItem={renderChallengeItem}
          keyExtractor={item => item.id}
          ListEmptyComponent={<Text style={styles.emptyText}>Aucun d√©fi disponible.</Text>}
        />
      )}
    </Animated.View>

    <Modal
      visible={showDetailsModal}
      transparent
      animationType="slide"
      onRequestClose={() => setShowDetailsModal(false)}
    >
      <View style={styles.modalContainer}>
        <View style={styles.modalContent}>
          {selectedConseil && (
            <>
              <Text style={styles.modalTitle}>{selectedConseil.title}</Text>
              <Text style={styles.modalDescription}>{selectedConseil.description}</Text>
              {selectedConseil.tips && (
                <View style={styles.tipsContainer}>
                  <Text style={styles.tipsTitle}>Conseils Pratiques:</Text>
                  {selectedConseil.tips.map((tip, index) => (
                    <Text key={index} style={styles.tipText}>‚Ä¢ {tip}</Text>
                  ))}
                </View>
              )}
              {selectedConseil.relatedLinks && (
                <View style={styles.linksContainer}>
                  <Text style={styles.linksTitle}>Liens Utiles:</Text>
                  {selectedConseil.relatedLinks.map((link, index) => (
                    <TouchableOpacity key={index} onPress={() => Linking.openURL(link)}>
                      <Text style={styles.linkText}>{link}</Text>
                    </TouchableOpacity>
                  ))}
                </View>
              )}
              <View style={styles.modalButtons}>
                <TouchableOpacity
                  style={styles.modalButton}
                  onPress={() => {
                    shareConseil(selectedConseil);
                    setShowDetailsModal(false);
                  }}
                >
                  <Text style={styles.modalButtonText}>Partager</Text>
                </TouchableOpacity>
                <TouchableOpacity
                  style={styles.modalButton}
                  onPress={() => setShowDetailsModal(false)}
                >
                  <Text style={styles.modalButtonText}>Fermer</Text>
                </TouchableOpacity>
              </View>
            </>
          )}
        </View>
      </View>
    </Modal>
  </View>
);
}

const styles = StyleSheet.create({
container: {
flex: 1,
backgroundColor: '#F5F5F5',
},
header: {
flexDirection: 'row',
justifyContent: 'space-between',
alignItems: 'center',
padding: 16,
backgroundColor: '#4CAF50',
},
headerTitle: {
fontSize: 24,
fontWeight: 'bold',
color: '#FFF',
},
points: {
fontSize: 18,
color: '#FFF',
},
searchContainer: {
flexDirection: 'row',
alignItems: 'center',
padding: 10,
backgroundColor: '#FFF',
marginHorizontal: 10,
borderRadius: 8,
marginVertical: 10,
},
searchInput: {
flex: 1,
fontSize: 16,
padding: 8,
},
micButton: {
padding: 8,
},
filterContainer: {
paddingHorizontal: 10,
marginBottom: 10,
},
filterButton: {
paddingVertical: 8,
paddingHorizontal: 16,
marginRight: 8,
backgroundColor: '#E0E0E0',
borderRadius: 20,
},
activeFilter: {
backgroundColor: '#4CAF50',
},
filterText: {
fontSize: 14,
color: '#000',
},
tabContainer: {
flexDirection: 'row',
justifyContent: 'space-around',
backgroundColor: '#FFF',
paddingVertical: 10,
},
tabButton: {
flex: 1,
alignItems: 'center',
paddingVertical: 10,
},
tabText: {
fontSize: 16,
color: '#757575',
},
activeTabText: {
color: '#4CAF50',
fontWeight: 'bold',
},
tabIndicator: {
position: 'absolute',
bottom: 0,
height: 3,
width: width / 5,
backgroundColor: 'green',
},
contentContainer: {
flex: 1,
paddingHorizontal: 10,
},
conseilCard: {
backgroundColor: '#FFF',
padding: 15,
marginVertical: 8,
borderRadius: 10,
shadowColor: '#000',
shadowOffset: { width: 0, height: 2 },
shadowOpacity: 0.1,
shadowRadius: 4,
elevation: 3,
},
conseilHeader: {
flexDirection: 'row',
justifyContent: 'space-between',
alignItems: 'center',
},
conseilTitle: {
fontSize: 18,
fontWeight: 'bold',
flex: 1,
},
conseilDescription: {
fontSize: 14,
color: '4CAF50  ',
marginVertical: 8,
},
conseilFooter: {
flexDirection: 'row',
justifyContent: 'space-between',
alignItems: 'center',
},
conseilPoints: {
fontSize: 14,
color: '#4CAF50',
},
quizCard: {
backgroundColor: '#FFF',
padding: 15,
marginVertical: 8,
borderRadius: 10,
shadowColor: '#000',
shadowOffset: { width: 0, height: 2 },
shadowOpacity: 0.1,
shadowRadius: 4,
elevation: 3,
},
completedQuiz: {
backgroundColor: '4CAF50  ',
opacity: 0.7,
},
quizQuestion: {
fontSize: 18,
fontWeight: 'bold',
marginBottom: 10,
},
quizOptions: {
marginVertical: 10,
},
quizOption: {
padding: 10,
backgroundColor: '#F5F5F5',
borderRadius: 5,
marginVertical: 5,
},
quizOptionText: {
fontSize: 16,
color: '#333',
},
quizPoints: {
fontSize: 14,
color: '#4CAF50',
marginTop: 10,
},
quizTimeLimit: {
fontSize: 14,
color: '#FF5252',
},
badgeCard: {
flex: 1,
margin: 8,
padding: 15,
borderRadius: 10,
alignItems: 'center',
justifyContent: 'center',
shadowColor: '#000',
shadowOffset: { width: 0, height: 2 },
shadowOpacity: 0.1,
shadowRadius: 4,
elevation: 3,
},
badgeName: {
fontSize: 16,
fontWeight: 'bold',
marginVertical: 8,
},
badgeDescription: {
fontSize: 14,
textAlign: 'center',
},
badgeDate: {
fontSize: 12,
color: '#FFF',
marginTop: 8,
},
challengeCard: {
backgroundColor: '#FFF',
padding: 15,
marginVertical: 8,
borderRadius: 10,
shadowColor: '#000',
shadowOffset: { width: 0, height: 2 },
shadowOpacity: 0.1,
shadowRadius: 4,
elevation: 3,
},
challengeTitle: {
fontSize: 18,
fontWeight: 'bold',
},
challengeDescription: {
fontSize: 14,
color: '#555',
marginVertical: 8,
},
challengeProgress: {
fontSize: 14,
color: '#2196F3',
},
challengeReward: {
fontSize: 14,
color: '#4CAF50',
},
challengeDeadline: {
fontSize: 14,
color: '#FF5252',
},
progressContainer: {
padding: 15,
backgroundColor: '#FFF',
borderRadius: 10,
margin: 10,
shadowColor: '#000',
shadowOffset: { width: 0, height: 2 },
shadowOpacity: 0.1,
shadowRadius: 4,
elevation: 3,
},
progressTitle: {
fontSize: 18,
fontWeight: 'bold',
marginBottom: 10,
},
progressText: {
fontSize: 16,
marginVertical: 5,
},
modalContainer: {
flex: 1,
justifyContent: 'center',
alignItems: 'center',
backgroundColor: 'rgba(0, 0, 0, 0.5)',
},
modalContent: {
backgroundColor: '#FFF',
padding: 20,
borderRadius: 10,
width: '90%',
maxHeight: '80%',
},
modalTitle: {
fontSize: 20,
fontWeight: 'bold',
marginBottom: 10,
},
modalDescription: {
fontSize: 16,
color: '#555',
marginBottom: 10,
},
tipsContainer: {
marginVertical: 10,
},
tipsTitle: {
fontSize: 16,
fontWeight: 'bold',
marginBottom: 5,
},
tipText: {
fontSize: 14,
color: '#333',
marginVertical: 2,
},
linksContainer: {
marginVertical: 10,
},
linksTitle: {
fontSize: 16,
fontWeight: 'bold',
marginBottom: 5,
},
linkText: {
fontSize: 14,
color: '#2196F3',
marginVertical: 2,
},
modalButtons: {
flexDirection: 'row',
justifyContent: 'space-around',
marginTop: 20,
},
modalButton: {
padding: 10,
backgroundColor: '#2196F0',
borderRadius: 5,
},
modalButtonText: {
color: '#FFF',
fontSize: 16,
},
emptyText: {
fontSize: 16,
color: '#757575',
textAlign: 'center',
marginTop: 20,
},
});